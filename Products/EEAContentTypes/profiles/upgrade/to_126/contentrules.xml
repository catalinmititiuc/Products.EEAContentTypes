<?xml version="1.0"?>
<contentrules>
  <rule name="rule-related-items-publish" title="Publish related items" cascading="True"
    description="Also publish related items when content is published"
    enabled="True" event="Products.CMFCore.interfaces.IActionSucceededEvent"
    stop-after="False">
  <conditions>
   <condition type="plone.conditions.WorkflowTransition">
    <property name="wf_transitions">
     <element>publish</element>
    </property>
   </condition>
   <condition type="plone.conditions.PortalType">
    <property name="check_types">
     <element>Report</element>
    </property>
   </condition>
  </conditions>
  <actions>
   <action type="eea.relations.workflow">
    <property name="backward_related_items">False</property>
    <property name="transition">publish</property>
    <property name="asynchronous">True</property>
    <property name="related_items">True</property>
   </action>
  </actions>
 </rule>
 <assignment name="rule-related-items-publish" bubbles="True" enabled="True" location=""/>
 <rule name="rule-related-items-published" title="Related Items published" cascading="False"
    description="Notify user that the content's related items were published"
    enabled="True"
    event="eea.relations.events.interfaces.IRelatedItemsWorkflowStateChanged"
    stop-after="False">
  <conditions/>
  <actions>
   <action type="plone.actions.Mail">
    <property name="source"/>
    <property
       name="message">The following related content was also published due to the publishing of "${title}" at ${related_items_url}:
     ${related_items_changed}

     The following items were already published or you do not have the right permissions to publish them:
     ${related_items_unchanged}


     ----------
     This email is auto-generated by EEA Web CMS and delivered to you because you are involved in the workflow. If you do not wish to receive these notifications anymore please contact EEA Web Admin or Helpdesk. You may also filter the emails via your mail client rules, e.g. outlook rules.
     ----------
    </property>
    <property
       name="subject">[EEA Web CMS] Published related items of ${title}</property>
    <property name="recipients">${user_email}</property>
    <property name="exclude_actor">False</property>
   </action>
  </actions>
 </rule>
 <assignment name="rule-related-items-published" bubbles="True" enabled="True" location=""/>
</contentrules>
