<?xml version="1.0"?>
<contentrules>
 <rule name="rule-40" title="Comment added"
    description="New comment added" enabled="True"
    event="plone.app.discussion.interfaces.ICommentAddedEvent"
    stop-after="False">
  <actions>
   <action type="plone.actions.Mail">
    <property name="source"/>
    <property
       name="message">A new comment has just been created on the EEA website by ${comment_user_fullname} (userid: ${comment_user_id} email: ${comment_user_email})

     Comment: "${comment_text}"

     Item type: ${type}
     Item state: ${review_state_title}
     Item title: "${title}"
     Item URL: ${url}

     ----------
     This email is auto-generated by EEA Web CMS and delivered to you because you are involved in the workflow.
     If you do not wish to receive these notifications anymore please contact EEA Web Admin or Helpdesk.
     You may also filter the emails via your mail client rules, e.g. outlook rules.
     ----------</property>
    <property
       name="subject">[EEA Web CMS] New comment created by ${comment_user_fullname}</property>
    <property name="recipients">${contributor_emails}</property>
    <property name="exclude_actor">False</property>
   </action>
  </actions>
 </rule>
 <rule name="rule-41" title="Comment reply"
    description="Comment replied" enabled="True"
    event="plone.app.discussion.interfaces.IReplyAddedEvent"
    stop-after="False">
  <actions>
   <action type="plone.actions.Mail">
    <property name="source"/>
    <property
       name="message">Comment replied on the EEA website by ${comment_user_fullname} (userid: ${comment_user_id} email: ${comment_user_email})

     Reply: "${comment_text}"

     Item type: ${type}
     Item state: ${review_state_title}
     Item title: "${title}"
     Item URL: ${url}

     ----------
     This email is auto-generated by EEA Web CMS and delivered to you because you are involved in the workflow.
     If you do not wish to receive these notifications anymore please contact EEA Web Admin or Helpdesk.
     You may also filter the emails via your mail client rules, e.g. outlook rules.
     ----------</property>
    <property
       name="subject">[EEA Web CMS] Comment replied  by ${comment_user_fullname}</property>
    <property name="recipients">${contributor_emails}</property>
    <property name="exclude_actor">False</property>
   </action>
  </actions>
 </rule>
 <rule name="rule-42" title="Comment deleted"
    description="Comment removed" enabled="True"
    event="plone.app.discussion.interfaces.ICommentRemovedEvent"
    stop-after="False">
  <actions>
   <action type="plone.actions.Mail">
    <property name="source"/>
    <property
       name="message">Comment removed on the EEA website by ${user_fullname} (userid: ${user_id} email: ${user_email})

     Comment: "${comment_text}"

     Item type: ${type}
     Item state: ${review_state_title}
     Item title: "${title}"
     Item URL: ${url}

     ----------
     This email is auto-generated by EEA Web CMS and delivered to you because you are involved in the workflow.
     If you do not wish to receive these notifications anymore please contact EEA Web Admin or Helpdesk.
     You may also filter the emails via your mail client rules, e.g. outlook rules.
     ----------</property>
    <property
       name="subject">[EEA Web CMS] Comment removed by ${user_fullname}</property>
    <property name="recipients">${contributor_emails}</property>
    <property name="exclude_actor">False</property>
   </action>
  </actions>
 </rule>
 <rule name="rule-43" title="Comment reply removed"
    description="Comment reply removed" enabled="True"
    event="plone.app.discussion.interfaces.IReplyRemovedEvent"
    stop-after="False">
  <actions>
   <action type="plone.actions.Mail">
    <property name="source"/>
    <property
       name="message">Comment reply removed on the EEA website by ${user_fullname} (userid: ${user_id} email: ${user_email})

     Comment: "${comment_text}"

     Item type: ${type}
     Item state: ${review_state_title}
     Item title: "${title}"
     Item URL: ${url}

     ----------
     This email is auto-generated by EEA Web CMS and delivered to you because you are involved in the workflow.
     If you do not wish to receive these notifications anymore please contact EEA Web Admin or Helpdesk.
     You may also filter the emails via your mail client rules, e.g. outlook rules.
     ----------</property>
    <property
       name="subject">[EEA Web CMS] Comment reply removed by ${user_fullname}</property>
    <property name="recipients">${contributor_emails}</property>
    <property name="exclude_actor">False</property>
   </action>
  </actions>
 </rule>
 <rule name="rule-purge-varnish-cache" title="Purge Varnish cache of translations" cascading="False"
    description="On publish, all translations and canonical will be purged from Varnish."
    enabled="True" event="Products.CMFCore.interfaces.IActionSucceededEvent" stop-after="False">
  <conditions>
   <condition type="plone.conditions.WorkflowState">
    <property name="wf_states">
     <element>published</element>
    </property>
   </condition>
  </conditions>
  <actions>
   <action type="Products.EEAContentTypes.actions.purge_varnish_cache"/>
  </actions>
 </rule>
 <assignment name="rule-purge-varnish-cache" bubbles="True" enabled="True" location=""/>
 <rule name="rule-44"
    title="Set effective/publishing date on new content with initial state &quot;published&quot;"
    description="On new content with initial state &quot;published&quot;, the effective/publishing date will be set
    if is missing; also a &quot;Publish&quot; entry will be added in object's workflow history."
    cascading="False" enabled="True" event="zope.lifecycleevent.interfaces.IObjectAddedEvent" stop-after="False">
  <conditions>
   <condition type="plone.conditions.WorkflowState">
    <property name="wf_states">
     <element>published</element>
    </property>
   </condition>
  </conditions>
  <actions>
   <action type="Products.EEAContentTypes.actions.set_effective_date">
    <property name="hist_entry">Yes</property>
    <property name="entry_action">Publish</property>
    <property name="entry_comment"/>
   </action>
  </actions>
 </rule>
 <assignment name="rule-44" bubbles="True" enabled="True" location=""/>
 <rule name="rule-related-items-publish" title="Publish related items" cascading="True"
    description="Also publish related items when content is published"
    enabled="True" event="Products.CMFCore.interfaces.IActionSucceededEvent"
    stop-after="False">
  <conditions>
   <condition type="plone.conditions.WorkflowTransition">
    <property name="wf_transitions">
     <element>publish</element>
    </property>
   </condition>
   <condition type="plone.conditions.PortalType">
    <property name="check_types">
     <element>Report</element>
    </property>
   </condition>
  </conditions>
  <actions>
   <action type="eea.relations.workflow">
    <property name="backward_related_items">False</property>
    <property name="transition">publish</property>
    <property name="asynchronous">True</property>
    <property name="related_items">True</property>
   </action>
  </actions>
 </rule>
 <assignment name="rule-related-items-publish" bubbles="True" enabled="True" location=""/>
 <rule name="rule-related-items-published" title="Related Items published" cascading="False"
    description="Notify user that the content's related items were published"
    enabled="True"
    event="eea.relations.events.interfaces.IRelatedItemsWorkflowStateChanged"
    stop-after="False">
  <conditions/>
  <actions>
   <action type="plone.actions.Mail">
    <property name="source"/>
    <property
       name="message">The following related content was also published due to the publishing of "${title}" at ${related_items_url}:
     ${related_items_changed}

     The following items were already published or you do not have the right permissions to publish them:
     ${related_items_unchanged}


     ----------
     This email is auto-generated by EEA Web CMS and delivered to you because you are involved in the workflow. If you do not wish to receive these notifications anymore please contact EEA Web Admin or Helpdesk. You may also filter the emails via your mail client rules, e.g. outlook rules.
     ----------
    </property>
    <property
       name="subject">[EEA Web CMS] Published related items of ${title}</property>
    <property name="recipients">${user_email}</property>
    <property name="exclude_actor">False</property>
   </action>
  </actions>
 </rule>
 <assignment name="rule-related-items-published" bubbles="True" enabled="True" location=""/>
</contentrules>
